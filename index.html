<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Academia de Fracciones</title>
<style>
body{
    font-family: 'Segoe UI', sans-serif;
    margin:0;
    background: linear-gradient(135deg,#4e73df,#1cc88a);
    color:#333;
}
.container{
    max-width:900px;
    margin:auto;
    padding:20px;
}
.card{
    background:white;
    padding:20px;
    border-radius:15px;
    box-shadow:0 8px 20px rgba(0,0,0,0.2);
    margin-bottom:20px;
}
h1{text-align:center;color:white;}
button{
    padding:10px 15px;
    border:none;
    border-radius:8px;
    background:#4e73df;
    color:white;
    font-weight:bold;
    cursor:pointer;
    margin:5px 0;
}
button:hover{background:#2e59d9;}
input{
    padding:8px;
    border-radius:6px;
    border:1px solid #ccc;
    margin:5px;
    width:80px;
    text-align:center;
}
.correct{color:green;font-weight:bold;}
.incorrect{color:red;font-weight:bold;}
.notes{
    width:100%;
    height:100px;
    margin-top:10px;
}
.progress{
    font-weight:bold;
}
</style>
</head>
<body>

<h1>ðŸ“˜ Academia de Fracciones</h1>

<div class="container">

<div class="card">
<button onclick="startPractice()">Modo PrÃ¡ctica</button>
<button onclick="startExam()">Modo Examen (10 ejercicios)</button>
</div>

<div class="card" id="exerciseCard" style="display:none;">
<div class="progress" id="progress"></div>
<p id="question"></p>

<div id="answerArea"></div>

<button onclick="checkAnswer()">Comprobar</button>
<button onclick="showSolution()">Ver soluciÃ³n paso a paso</button>

<div id="feedback"></div>
<div id="solution"></div>

<textarea class="notes" placeholder="âœï¸ Apuntes..."></textarea>
</div>

<div class="card" id="resultCard" style="display:none;">
<h2>Resultado Final</h2>
<p id="finalScore"></p>
<button onclick="location.reload()">Reiniciar</button>
</div>

<div class="card">
<h3>Historial</h3>
<div id="history"></div>
</div>

</div>

<script>

let mode = "practice";
let current = 0;
let totalExercises = 10;
let score = 0;
let exerciseData = [];

const contexts = [
"En una tienda online",
"En un campeonato de videojuegos",
"En una excursiÃ³n escolar",
"En una receta de cocina",
"En una competiciÃ³n deportiva",
"En una biblioteca",
"En un festival",
"En un parque de atracciones"
];

function randomInt(min,max){
    return Math.floor(Math.random()*(max-min+1))+min;
}

function gcd(a,b){
    while(b){[a,b]=[b,a%b];}
    return a;
}

function lcm(a,b){
    return (a*b)/gcd(a,b);
}

function simplify(n,d){
    let g = gcd(n,d);
    return [n/g,d/g];
}

function generateExercise(){
    let d1 = randomInt(3,12);
    let d2 = randomInt(3,12);
    while(d1===d2){d2=randomInt(3,12);}
    let n1 = randomInt(1,d1-1);
    let n2 = randomInt(1,d2-1);

    let context = contexts[randomInt(0,contexts.length-1)];
    let total = randomInt(100,500);

    return {n1,d1,n2,d2,context,total};
}

function startPractice(){
    mode="practice";
    totalExercises=1;
    start();
}

function startExam(){
    mode="exam";
    totalExercises=10;
    start();
}

function start(){
    current=0;
    score=0;
    exerciseData=[];
    document.getElementById("exerciseCard").style.display="block";
    document.getElementById("resultCard").style.display="none";
    nextExercise();
}

function nextExercise(){
    if(current>=totalExercises){
        endExam();
        return;
    }
    document.getElementById("feedback").innerHTML="";
    document.getElementById("solution").innerHTML="";
    let data = generateExercise();
    exerciseData.push(data);
    document.getElementById("progress").innerText="Ejercicio "+(current+1)+" de "+totalExercises;
    document.getElementById("question").innerHTML=
    `${data.context} hay ${data.total} personas.
    ${data.n1}/${data.d1} participan en una actividad y ${data.n2}/${data.d2} en otra.
    Â¿QuÃ© fracciÃ³n participa en total? Â¿CuÃ¡ntas personas son?`;

    document.getElementById("answerArea").innerHTML=`
    FracciÃ³n total:
    <input id="num"> /
    <input id="den"><br>
    Personas:
    <input id="people">
    `;
}

function checkAnswer(){
    let data = exerciseData[current];
    let l = lcm(data.d1,data.d2);
    let totalNum = data.n1*(l/data.d1)+data.n2*(l/data.d2);
    let simp = simplify(totalNum,l);

    let userN=parseInt(document.getElementById("num").value);
    let userD=parseInt(document.getElementById("den").value);
    let userP=parseInt(document.getElementById("people").value);

    let correctPeople = (simp[0]/simp[1])*data.total;

    if(userN===simp[0] && userD===simp[1] && userP===correctPeople){
        document.getElementById("feedback").innerHTML="<span class='correct'>âœ” Correcto</span>";
        score++;
    }else{
        document.getElementById("feedback").innerHTML="<span class='incorrect'>âœ˜ Incorrecto</span>";
    }

    current++;
    if(mode==="practice"){
        setTimeout(()=>nextExercise(),2000);
    }
}

function showSolution(){
    let data = exerciseData[current];
    let l = lcm(data.d1,data.d2);
    let adj1 = data.n1*(l/data.d1);
    let adj2 = data.n2*(l/data.d2);
    let totalNum = adj1+adj2;
    let simp = simplify(totalNum,l);
    let people = (simp[0]/simp[1])*data.total;

    document.getElementById("solution").innerHTML=`
    <hr>
    <b>Paso 1:</b> MCM(${data.d1},${data.d2}) = ${l}<br>
    <b>Paso 2:</b> Ajustamos: ${adj1}/${l} + ${adj2}/${l}<br>
    <b>Paso 3:</b> Sumamos: ${totalNum}/${l}<br>
    <b>Paso 4:</b> Simplificamos: ${simp[0]}/${simp[1]}<br>
    <b>Paso 5:</b> ${simp[0]}/${simp[1]} de ${data.total} = ${people} personas
    `;
}

function endExam(){
    document.getElementById("exerciseCard").style.display="none";
    document.getElementById("resultCard").style.display="block";
    let grade = (score/totalExercises)*10;
    document.getElementById("finalScore").innerHTML=
    `Nota final: ${grade.toFixed(2)} / 10`;

    saveHistory(grade.toFixed(2));
}

function saveHistory(grade){
    let history = JSON.parse(localStorage.getItem("fractionHistory")) || [];
    history.push({date:new Date().toLocaleString(),grade});
    localStorage.setItem("fractionHistory",JSON.stringify(history));
    loadHistory();
}

function loadHistory(){
    let history = JSON.parse(localStorage.getItem("fractionHistory")) || [];
    let html="";
    history.forEach(h=>{
        html+=`ðŸ“… ${h.date} â†’ Nota: ${h.grade}/10<br>`;
    });
    document.getElementById("history").innerHTML=html;
}

loadHistory();

</script>

</body>
</html>
